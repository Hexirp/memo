# the learned things from developing hexyll

hexyll の開発で学んだことについて書いていく。

## 容赦なく削除する

いらない機能は容赦なく削除する。私の手には負えない。

幸い Haskell は型があるので、きちんと修正すべき分岐も教えてくれる。

## 困難は分割する

パッケージがメモリを使いすぎてビルドできないなら、複数のパッケージに分割する。

パッケージに GPL であるべきコードが混入していたら、その部分を別のパッケージに切り出す。

## ビルド時のフラグはできるだけ使うな

デフォルトの状態で正常にビルドできるのは簡単にチェックできる。なら、変更した時は？

## stack を使え

複数の GHC でビルドしたいときも stack を使うべきだ。それは、リソルバがあることによって、それぞれの依存パッケージにおいて、どのくらいのバージョンの範囲に対応すべきか分かるからだ。そして、サポートできているかを確かめることができる。

## hpack を使え

モジュールのファイルを作るだけでパッケージに含まれるようになるのは細かいことだがストレスがない。

モジュールの名前を変えたときも、いちいち cabal ファイルを変えに行く必要がなくなる。

## cryptonite を使え

cryptohash は非推奨になった。これを使ってねと紹介されているのが cryptonite だ。

## コードは時々掃除せよ

古い base のバージョンに対応するための CPP や、もう使われていない言語拡張のプラグマを見るのはもうたくさんだ。

## Windows でもビルドせよ

ビルドすることでしか非互換性は見つけられない。

## テストは愚直に書け

自動的にテストに番号を付けるクールな関数だって？　どんな内容のテストで失敗したのかわからないだろうが。おまけに `printf` 関数を内部で使っているしな。

## IDE を使え

関数の名前を変更するたびに Vim で `:%s/.../.../` と `:wn` を繰り返し打ち続けるのは苦行だ。

## path を使え

`FilePath` 型ではなく `Path` 型を使え。これは path パッケージのだ。このパッケージは素晴らしい。

## binary のドキュメントは少ないことを肝に銘じろ

`Binary` 型クラスのインスタンスの書き方は、公式ドキュメントで一回だけ触れられるだけだ。しかしも、それが `Alternative` 型クラスになっていることは教えてくれない。そして、その `empty` が失敗を表すことは内部実装を読むことでしか知れない。

## 予想する原因の中に単純な間違いを常に入れておけ

タイポ、インポート忘れ、型の変え忘れ、名前の変え忘れ、引数の渡し忘れ、いろいろだ。
